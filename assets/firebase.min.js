$(document).ready(function(){let e=$("#txtRootUrl").val();var t=null,n="",a="";let o=async()=>{let e=await i();if(t=e.firebaseConfig,a=e.UserID,n=e.fcmToken,""!=a){firebase.initializeApp(config);let o=firebase.messaging();o.requestPermission().then(function(){""!=n&&s()}).catch(function(e){console.log("Unable to get permission to notify.",e)}),o.onMessage(function(e){var t=e.data.title,n={body:e.data.body,icon:e.data.icon,image:e.data.image,data:{time:new Date(Date.now()).toString(),click_action:e.data.click_action}};new Notification(t,n)})}},i=async()=>await new Promise((t,n)=>{$.ajax({type:"post",url:e+"get/firebase-config",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},dataType:"json",async:!0,error(){t(null)},async success(e){t(e)}})}),c=async t=>{""!=a&&$.ajax({type:"post",url:e+"firebase/fcm-token/save",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},data:{fcmToken:t,UserID:a},dataType:"json",async:!0})},s=async()=>{messaging.getToken().then(function(e){e?(n=e,c(e)):(console.log("No Instance ID token available. Request permission to generate one."),setTokenSentToServer(!1))}).catch(function(e){console.log("An error occurred while retrieving token. ",e),setTokenSentToServer(!1)})};o()});